<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta property="og:type" content="website">
<meta property="og:title" content="yujiang-zheng&#39;s blog">
<meta property="og:url" content="http://HandsomeMars.github.io/page/3/index.html">
<meta property="og:site_name" content="yujiang-zheng&#39;s blog">
<meta property="og:locale" content="zh">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="yujiang-zheng&#39;s blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://HandsomeMars.github.io/page/3/">





  <title>yujiang-zheng's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">yujiang-zheng's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/06/10/解决zookeeper集群重启 Error contacting service. It is probably not running 问题/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/10/解决zookeeper集群重启 Error contacting service. It is probably not running 问题/" itemprop="url">解决zookeeper集群重启 Error contacting service. It is probably not running 问题</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-10T12:08:49+08:00">
                2018-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80639492" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80639492</a>   </p>
<h2 id="一-问题出现情形"><a href="#一-问题出现情形" class="headerlink" title="一 问题出现情形"></a>一 问题出现情形</h2><h3 id="1-集群启动后异常关闭，重启出错"><a href="#1-集群启动后异常关闭，重启出错" class="headerlink" title="1 集群启动后异常关闭，重启出错"></a>1 集群启动后异常关闭，重启出错</h3><h3 id="2-集群未正常启动"><a href="#2-集群未正常启动" class="headerlink" title="2 集群未正常启动"></a>2 集群未正常启动</h3><h2 id="二-查看zookeeper-out分析原因"><a href="#二-查看zookeeper-out分析原因" class="headerlink" title="二 查看zookeeper.out分析原因"></a>二 查看zookeeper.out分析原因</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat zookeeper.out</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180610120435960?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="1-网络问题。排查防火墙"><a href="#1-网络问题。排查防火墙" class="headerlink" title="1 网络问题。排查防火墙"></a>1 网络问题。排查防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">java.net.NoRouteToHostException: 没有到主机的路由 (Host unreachable)</span><br><span class="line">	at java.net.PlainSocketImpl.socketConnect(Native Method)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.doConnect(AbstractPlainSocketImpl.java:350)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.connectToAddress(AbstractPlainSocketImpl.java:206)</span><br><span class="line">	at java.net.AbstractPlainSocketImpl.connect(AbstractPlainSocketImpl.java:188)</span><br><span class="line">	at java.net.SocksSocketImpl.connect(SocksSocketImpl.java:392)</span><br><span class="line">	at java.net.Socket.connect(Socket.java:589)</span><br><span class="line">	at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectOne(QuorumCnxManager.java:558)</span><br><span class="line">	at org.apache.zookeeper.server.quorum.QuorumCnxManager.connectAll(QuorumCnxManager.java:610)</span><br><span class="line">	at org.apache.zookeeper.server.quorum.FastLeaderElection.lookForLeader(FastLeaderElection.java:838)</span><br><span class="line">	at org.apache.zookeeper.server.quorum.QuorumPeer.run(QuorumPeer.java:957)</span><br></pre></td></tr></table></figure>

<p>解决步骤：问题排查 7 -&gt;[2、6] -&gt;重启集群</p>
<h3 id="2-初次启动。"><a href="#2-初次启动。" class="headerlink" title="2 初次启动。"></a>2 初次启动。</h3><p>解决步骤：问题排查1–&gt;2–&gt;3–&gt;4–&gt;5–&gt;7–&gt;重启集群</p>
<p>备注：初次启动 个个环节都有可能有问题 如果有报错信息可以针对性解决</p>
<h3 id="3-重新启动。"><a href="#3-重新启动。" class="headerlink" title="3 重新启动。"></a>3 重新启动。</h3><p>解决步骤：暂停集群–&gt;2–&gt;6–&gt;7–&gt;重启集群</p>
<p>备注：重新启动主要是，节点配置信息问题以及防火墙问题。需要按顺序，暂停zookeeper，kill进程，删除节点信息，关闭防火墙，再次启动集群</p>
<p><img src="https://img-blog.csdn.net/20180610120043137?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180610120102261?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180610120127959?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h2 id="三-问题排查"><a href="#三-问题排查" class="headerlink" title="三 问题排查"></a>三 问题排查</h2><h3 id="1-java环境"><a href="#1-java环境" class="headerlink" title="1 java环境"></a>1 java环境</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h3 id="2-排查端口占用"><a href="#2-排查端口占用" class="headerlink" title="2 排查端口占用"></a>2 排查端口占用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netstat -apn | grep 2181   #默认2181端口为服务端提供端口</span><br></pre></td></tr></table></figure>

<p>备注：若集群未启动 则不应该有端口占用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kill -9 pid                #pid为占用端口的进程id号</span><br></pre></td></tr></table></figure>

<h3 id="3-排除网卡问题"><a href="#3-排除网卡问题" class="headerlink" title="3 排除网卡问题"></a>3 排除网卡问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180610111517531?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>备注：如果为物理地址则 重启网卡</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<h3 id="4-排除网络问题"><a href="#4-排除网络问题" class="headerlink" title="4 排除网络问题"></a>4 排除网络问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ping ip               #ping其他节点主机 若zoo.cfg 使用域名则用域名</span><br></pre></td></tr></table></figure>

<p>备注：无ping命令则安装 yum install iputils-ping 若有问题则 host映射问题  </p>
<h3 id="5-排查节点配置信息"><a href="#5-排查节点配置信息" class="headerlink" title="5 排查节点配置信息"></a>5 排查节点配置信息</h3><p>dataDir 是否存在 myid文件内容与 service.x 中x对应</p>
<p>例如：zk01 其对应service.x 则该目录下myid内容为1</p>
<p><img src="https://img-blog.csdn.net/2018061011205094?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="6-删除节点残留信息"><a href="#6-删除节点残留信息" class="headerlink" title="6 删除节点残留信息"></a>6 删除节点残留信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rm -rf version-2/ zookeeper_server.pid</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/2018061011250189?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="7-防火墙拦截端口"><a href="#7-防火墙拦截端口" class="headerlink" title="7 防火墙拦截端口"></a>7 防火墙拦截端口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status firewalld.service</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/201806101149468?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld.service #关闭防火墙</span><br><span class="line">systemctl disable firewalld.service #禁止启动防火墙</span><br></pre></td></tr></table></figure>





          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/06/10/docker 容器中安装命令/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/10/docker 容器中安装命令/" itemprop="url">docker 容器中安装命令</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-10T01:40:38+08:00">
                2018-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80637971" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80637971</a>   </p>
   <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">apt-get update    ##跟新</span><br><span class="line">//vi</span><br><span class="line">apt install vim</span><br><span class="line">//weget</span><br><span class="line">apt install weget</span><br><span class="line">//yum</span><br><span class="line">apt install yum</span><br><span class="line">//ifconfig </span><br><span class="line">apt install net-tools       </span><br><span class="line">//ping</span><br><span class="line">apt install iputils-ping</span><br></pre></td></tr></table></figure>




          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/06/10/docker 配置mysql主从复制/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/10/docker 配置mysql主从复制/" itemprop="url">docker 配置mysql主从复制</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-10T01:31:12+08:00">
                2018-06-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80637787" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80637787</a>   </p>
<h2 id="一-前提条件"><a href="#一-前提条件" class="headerlink" title="一 前提条件"></a>一 前提条件</h2><h3 id="1-具有docker环境的centos7"><a href="#1-具有docker环境的centos7" class="headerlink" title="1 具有docker环境的centos7"></a>1 具有docker环境的centos7</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install docker</span><br><span class="line">service docker start</span><br></pre></td></tr></table></figure>

<h3 id="2-mysql镜像（版本5-5以上，本文采用8-0）"><a href="#2-mysql镜像（版本5-5以上，本文采用8-0）" class="headerlink" title="2 mysql镜像（版本5.5以上，本文采用8.0）"></a>2 mysql镜像（版本5.5以上，本文采用8.0）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull mysql:8.0</span><br></pre></td></tr></table></figure>



<h2 id="二-mysql集群配置文件"><a href="#二-mysql集群配置文件" class="headerlink" title="二 mysql集群配置文件"></a>二 mysql集群配置文件</h2><h3 id="1-创建配置集结构如下"><a href="#1-创建配置集结构如下" class="headerlink" title="1 创建配置集结构如下"></a>1 创建配置集结构如下</h3><p><img src="https://img-blog.csdn.net/20180610003121735?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /home/data/mysql/data/master</span><br><span class="line">mkdir -p /home/data/mysql/data/slave</span><br><span class="line">mkdir -p /home/data/mysql/master</span><br><span class="line">mkdir -p /home/data/mysql/slave</span><br></pre></td></tr></table></figure>

<h3 id="2-创建节点配置文件（master-cnf与slave-cnf）"><a href="#2-创建节点配置文件（master-cnf与slave-cnf）" class="headerlink" title="2 创建节点配置文件（master.cnf与slave.cnf）"></a>2 创建节点配置文件（master.cnf与slave.cnf）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/data/mysql/master</span><br><span class="line">vi master.cnf</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/data/mysql/slave</span><br><span class="line">vi slave.cnf</span><br></pre></td></tr></table></figure>

<p>内容如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[mysqld]</span><br><span class="line">server-id=1   #任意自然数n，只要保证两台MySQL主机不重复就可以了。</span><br><span class="line">log-bin=mysql-bin   #开启二进制日志</span><br><span class="line">#auto_increment_increment=2   #步进值auto_imcrement。一般有n台主MySQL就填n</span><br><span class="line">#auto_increment_offset=1   #起始值。一般填第n台主MySQL。此时为第一台主MySQL</span><br><span class="line">#binlog-ignore=mysql   #忽略mysql库【我一般都不写】</span><br><span class="line">#binlog-ignore=information_schema   #忽略information_schema库【我一般都不写】</span><br><span class="line">#replicate-do-db=aa   #要同步的数据库，默认所有库</span><br></pre></td></tr></table></figure>

<h2 id="三、搭建mysql环境"><a href="#三、搭建mysql环境" class="headerlink" title="三、搭建mysql环境"></a>三、搭建mysql环境</h2><h3 id="1-为mysql容器创建专有桥接网络，以便固定mysql容器ip"><a href="#1-为mysql容器创建专有桥接网络，以便固定mysql容器ip" class="headerlink" title="1 为mysql容器创建专有桥接网络，以便固定mysql容器ip"></a>1 为mysql容器创建专有桥接网络，以便固定mysql容器ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network create --driver bridge --subnet 172.25.0.0/16 mysql_net</span><br></pre></td></tr></table></figure>

<p>备注：创建桥接网卡 mysql_net 指定自网段为172.25.0.0 如果不指定ip则与docker容器的docker0网卡同网段<br><img src="https://img-blog.csdn.net/20180610005049731?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="2-创建mysql容器"><a href="#2-创建mysql容器" class="headerlink" title="2 创建mysql容器"></a>2 创建mysql容器</h3><p>（1） master </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker create </span><br><span class="line">--privileged=true                               #为容器挂载目录添加权限</span><br><span class="line">--name mysqlmaster                              #容器名为mysqlmaster</span><br><span class="line">-v /home/data/mysql/data/master:/var/lib/mysql  #集群配置集中/data/master 挂载到容器/var/lib/mysql</span><br><span class="line">-v /home/data/mysql/master:/etc/mysql/conf.d    #配置集中/master 中master.cnf 挂载到 /etc/mysql/conf.d中设置启动</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root                     #设置启动密码</span><br><span class="line">--net mysql_net                                 #指定容器连接网络</span><br><span class="line">--ip 172.25.0.3                                 #指定容器使用ip</span><br><span class="line">-p 3307:3306 mysql:8.0                          #指定主机映射到容器端口  即 主机访问centos7 为3307   容器端口为3306</span><br></pre></td></tr></table></figure>

<p>备注：上面#号后需要删除</p>
<p>（2）salve</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker create </span><br><span class="line">--privileged=true </span><br><span class="line">--name mysqlslave </span><br><span class="line">-v /home/data/mysql/data/slave:/var/lib/mysql </span><br><span class="line">-v /home/data/mysql/salve:/etc/mysql/conf.d -e MYSQL_ROOT_PASSWORD=root </span><br><span class="line">--net mysql_net </span><br><span class="line">--ip 172.25.0.2 </span><br><span class="line">-p 3308:3306 mysql:8.0</span><br></pre></td></tr></table></figure>

<p>备注：同上</p>
<h3 id="3-启动容器"><a href="#3-启动容器" class="headerlink" title="3 启动容器"></a>3 启动容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker start mysqlsalve</span><br><span class="line">docker start mysqlmaster</span><br></pre></td></tr></table></figure>

<p>查看运行状态</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps -a</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/2018061001023130?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>查看容器ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect mysql_net</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180610010405762?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h3 id="4-容器设置远程访问"><a href="#4-容器设置远程访问" class="headerlink" title="4 容器设置远程访问"></a>4 容器设置远程访问</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it mysqlmaster /bin/bash</span><br></pre></td></tr></table></figure>

<p>使用容器ip登录 并输入密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -p  -h 172.25.0.3</span><br></pre></td></tr></table></figure>

<p>修改root帐号密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ALTER USER &apos;root&apos;@&apos;%&apos; IDENTIFIED WITH mysql_native_password BY &apos;root&apos;;</span><br></pre></td></tr></table></figure>

<p>备注：同理进入另一个容器相同操作</p>
<h3 id="5-使用navicat在主机（非centos7）登录mysql容器"><a href="#5-使用navicat在主机（非centos7）登录mysql容器" class="headerlink" title="5 使用navicat在主机（非centos7）登录mysql容器"></a>5 使用navicat在主机（非centos7）登录mysql容器</h3><p><img src="https://img-blog.csdn.net/20180610011115865?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/20180610011259100?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>备注：容器ip为docker容器内部路由使用，虚拟机ip为外部主机入口，可以通过桥接访问到容器  </p>
<h2 id="四-启动mysql主从"><a href="#四-启动mysql主从" class="headerlink" title="四 启动mysql主从"></a>四 启动mysql主从</h2><h3 id="1-进入master-赋权限-以及查询master-的日志文件-以及位置"><a href="#1-进入master-赋权限-以及查询master-的日志文件-以及位置" class="headerlink" title="1 进入master 赋权限 以及查询master 的日志文件 以及位置"></a>1 进入master 赋权限 以及查询master 的日志文件 以及位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">SET sql_mode=(SELECT REPLACE(@@sql_mode,&apos;ONLY_FULL_GROUP_BY&apos;,&apos;&apos;));</span><br><span class="line">GRANT REPLICATION SLAVE ON *.* to &apos;root&apos;@&apos;%&apos; identified by &apos;root&apos;; --赋权限给root用户</span><br><span class="line">flush privileges; --刷新权限</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show master status;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180610011645633?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h3 id="2-进入slave-设置slave配置以及启动slave"><a href="#2-进入slave-设置slave配置以及启动slave" class="headerlink" title="2 进入slave 设置slave配置以及启动slave"></a>2 进入slave 设置slave配置以及启动slave</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">change master to </span><br><span class="line">master_host=&apos;172.25.0.3&apos;,     --master的ip  不能为127.0.0.1</span><br><span class="line">master_user=&apos;root&apos;,           --master的帐号密码</span><br><span class="line">master_password=&apos;root&apos;,</span><br><span class="line">master_log_file=&apos;mysql-bin.000003&apos;, --master 查询的file名  注意上面！</span><br><span class="line">master_port=3306,                   --master 端口 坑！为容器端口 不是主机端口</span><br><span class="line">master_log_pos=596;                 --日志文件位置  注意上面！</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">start slave;</span><br><span class="line">show slave status;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180610012221654?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>备注：主从同步启动标志 若出现cennecting to master 则有错误 请自己查找</p>
<h3 id="3-验证主从"><a href="#3-验证主从" class="headerlink" title="3 验证主从"></a>3 验证主从</h3><p>主库创建任何数据，从库随即更新！</p>
<p><img src="https://img-blog.csdn.net/2018061001273851?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>祝你成功！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/06/01/centos7 搭建zookeeper集群/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/centos7 搭建zookeeper集群/" itemprop="url">centos7 搭建zookeeper集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T22:41:35+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80542250" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80542250</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><h3 id="1、centos7-（物理机或虚拟机-2n-1）"><a href="#1、centos7-（物理机或虚拟机-2n-1）" class="headerlink" title="1、centos7 （物理机或虚拟机 2n+1）"></a>1、centos7 （物理机或虚拟机 2n+1）</h3><p>2、jdk环境 <a href="https://blog.csdn.net/qq_22211217/article/details/80532381" target="_blank" rel="noopener">配置jdk</a></p>
<h2 id="二-下载解压zookeeper"><a href="#二-下载解压zookeeper" class="headerlink" title="二 下载解压zookeeper"></a>二 下载解压zookeeper</h2><h3 id="1-通过webget命令"><a href="#1-通过webget命令" class="headerlink" title="1 通过webget命令"></a>1 通过webget命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://mirrors.tuna.tsinghua.edu.cn/apache/zookeeper/zookeeper-3.4.12/zookeeper-3.4.12.tar.gz -p /home</span><br></pre></td></tr></table></figure>

<p>备注：若没有webget命令工具 使用yum install webget进行安装</p>
<p>-p 指定下载目标目录 </p>
<h3 id="2-通过rz命令"><a href="#2-通过rz命令" class="headerlink" title="2 通过rz命令"></a>2 通过rz命令</h3><p><a href="https://blog.csdn.net/qq_22211217/article/details/80531336" target="_blank" rel="noopener">rz具体操作</a>  </p>
<h3 id="3-解压zookeeper"><a href="#3-解压zookeeper" class="headerlink" title="3 解压zookeeper"></a>3 解压zookeeper</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf /home/zookeeper-3.4.12.tar.gz</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601200552606?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h3 id="4-其他两台虚拟机同样操作-or-使用-scp命令进行服务器间复制文件"><a href="#4-其他两台虚拟机同样操作-or-使用-scp命令进行服务器间复制文件" class="headerlink" title="4 其他两台虚拟机同样操作 or 使用 scp命令进行服务器间复制文件"></a>4 其他两台虚拟机同样操作 or 使用 scp命令进行服务器间复制文件</h3><h2 id="三-配置zookeeper节点配置"><a href="#三-配置zookeeper节点配置" class="headerlink" title="三 配置zookeeper节点配置"></a>三 配置zookeeper节点配置</h2><h3 id="1-配置host文件，为三个节点配置域名-方便访问（可以不设置-则对应域名使用真实ip）"><a href="#1-配置host文件，为三个节点配置域名-方便访问（可以不设置-则对应域名使用真实ip）" class="headerlink" title="1 配置host文件，为三个节点配置域名 方便访问（可以不设置 则对应域名使用真实ip）"></a>1 配置host文件，为三个节点配置域名 方便访问（可以不设置 则对应域名使用真实ip）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br></pre></td></tr></table></figure>

<p>在末尾加入 ip 域名 保存退出后生效</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">192.168.253.6 zk01</span><br><span class="line">192.168.253.4 zk02</span><br><span class="line">192.168.253.3 zk03</span><br></pre></td></tr></table></figure>

<h3 id="2-其他两台同样修改-or-使用-scp命令进行服务器间复制"><a href="#2-其他两台同样修改-or-使用-scp命令进行服务器间复制" class="headerlink" title="2 其他两台同样修改 or 使用 scp命令进行服务器间复制"></a>2 其他两台同样修改 or 使用 scp命令进行服务器间复制</h3><h3 id="3-测试网络连接"><a href="#3-测试网络连接" class="headerlink" title="3 测试网络连接"></a>3 测试网络连接</h3><p><img src="https://img-blog.csdn.net/20180601220026621?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="4-配置节点信息"><a href="#4-配置节点信息" class="headerlink" title="4 配置节点信息"></a>4 配置节点信息</h3><p>复制模版文件并取名zoo.cfg</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp /home/zookeeper-3.4.12/conf/zoo_sample.cfg /home/zookeeper-3.4.12/conf/zoo.cfg</span><br></pre></td></tr></table></figure>

<p>修改模版文件如下 需要指定数据保存位置 以及 行末添加节点配置信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /home/zookeeper-3.4.12/conf/zoo.cfg</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># The number of milliseconds of each tick       时间单位 2000ms</span><br><span class="line">tickTime=2000</span><br><span class="line"># The number of ticks that the initial </span><br><span class="line"># synchronization phase can take                初识化允许时间单位 10个</span><br><span class="line">initLimit=10</span><br><span class="line"># The number of ticks that can pass between     响应时间允许时间单位 5个</span><br><span class="line"># sending a request and getting an acknowledgement</span><br><span class="line">syncLimit=5</span><br><span class="line"># the directory where the snapshot is stored.   数据保存位置  自定义并且必须存在</span><br><span class="line"># do not use /tmp for storage, /tmp here is just </span><br><span class="line"># example sakes.</span><br><span class="line">dataDir=/home/data/zookeeper</span><br><span class="line"># the port at which the clients will connect    客户端连接端口</span><br><span class="line">clientPort=2181</span><br><span class="line"># the maximum number of client connections.</span><br><span class="line"># increase this if you need to handle more clients</span><br><span class="line">#maxClientCnxns=60</span><br><span class="line">#</span><br><span class="line"># Be sure to read the maintenance section of the </span><br><span class="line"># administrator guide before turning on autopurge.</span><br><span class="line">#</span><br><span class="line"># http://zookeeper.apache.org/doc/current/zookeeperAdmin.html#sc_maintenance</span><br><span class="line">#</span><br><span class="line"># The number of snapshots to retain in dataDir</span><br><span class="line">#autopurge.snapRetainCount=3</span><br><span class="line"># Purge task interval in hours</span><br><span class="line"># Set to &quot;0&quot; to disable auto purge feature</span><br><span class="line">#autopurge.purgeInterval=1                     zookeeper node配置  service.x = ip:内部通信端口：leader监听端口</span><br><span class="line">server.1=zk01:2888:3888</span><br><span class="line">server.2=zk02:2888:3888</span><br><span class="line">server.3=zk03:2888:3888</span><br></pre></td></tr></table></figure>


<p>备注：在zookeeper安装目录conf内有一个模版文件zoo_sample.cfg 复制并保存为zoo.cfg 生效</p>
<p>service.x = ip:内部端口：leader端口 x为数据保存路径下myid内容</p>
<h3 id="5-创建数据保存目录以及myid文件"><a href="#5-创建数据保存目录以及myid文件" class="headerlink" title="5 创建数据保存目录以及myid文件"></a>5 创建数据保存目录以及myid文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/data/zookeeper</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /home/data/zookeeper</span><br><span class="line">echo 1&gt;&gt; myid</span><br></pre></td></tr></table></figure>

<p>备注：echo 1 &gt;&gt;myid 译为编写myid文件 内容为1 其中 1与zk01对应 与zoo.cfg 节点配置对应  </p>
<h3 id="6-其他虚拟机相同操作-or-使用scp-命令进行文件复制"><a href="#6-其他虚拟机相同操作-or-使用scp-命令进行文件复制" class="headerlink" title="6 其他虚拟机相同操作 or 使用scp 命令进行文件复制"></a>6 其他虚拟机相同操作 or 使用scp 命令进行文件复制</h3><h2 id="四-启动集群"><a href="#四-启动集群" class="headerlink" title="四 启动集群"></a>四 启动集群</h2><h3 id="1-三台机器启动"><a href="#1-三台机器启动" class="headerlink" title="1 三台机器启动"></a>1 三台机器启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/zookeeper-3.4.12/bin/zkServer.sh start</span><br></pre></td></tr></table></figure>

<h3 id="2-查看状态"><a href="#2-查看状态" class="headerlink" title="2 查看状态"></a>2 查看状态</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/home/zookeeper-3.4.12/bin/zkServer.sh status</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601223433655?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/2018060122350543?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/2018060122351720?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>祝你成功</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/06/01/centos7 安装 JDK环境/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/06/01/centos7 安装 JDK环境/" itemprop="url">centos7 安装 JDK环境</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-06-01T01:06:05+08:00">
                2018-06-01
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80532381" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80532381</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><h3 id="1、centos7环境"><a href="#1、centos7环境" class="headerlink" title="1、centos7环境"></a>1、centos7环境</h3><p>2、网络配置</p>
<h2 id="二-下载安装jdk"><a href="#二-下载安装jdk" class="headerlink" title="二 下载安装jdk"></a>二 下载安装jdk</h2><h3 id="1-使用yum查看jdk版本"><a href="#1-使用yum查看jdk版本" class="headerlink" title="1 使用yum查看jdk版本"></a>1 使用yum查看jdk版本</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum search java | grep -i --color JDK                 #查看JDK软件包列表</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601005305869?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="2-使用yum-命令下载jdk"><a href="#2-使用yum-命令下载jdk" class="headerlink" title="2 使用yum 命令下载jdk"></a>2 使用yum 命令下载jdk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install java-1.8.0-openjdk*        #安装所有java1.8.0所有Java包</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601005723223?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="3-使用yun-命令卸载jdk"><a href="#3-使用yun-命令卸载jdk" class="headerlink" title="3 使用yun 命令卸载jdk"></a>3 使用yun 命令卸载jdk</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum list installed |grep java           #查看安装列表</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum -y remove java-1.8.0-openjdk*       #卸载所有openjdk相关文件  </span><br><span class="line">yum -y remove tzdata-java.noarch        #卸载tzdata-java</span><br></pre></td></tr></table></figure>



<h2 id="三-设置环境变量"><a href="#三-设置环境变量" class="headerlink" title="三 设置环境变量"></a>三 设置环境变量</h2><h3 id="1-查看jdk安装位置"><a href="#1-查看jdk安装位置" class="headerlink" title="1 查看jdk安装位置"></a>1 查看jdk安装位置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls -l  /usr/lib/jvm  #jdk默认安装路径</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601005859400?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h3 id="2-编辑环境变量"><a href="#2-编辑环境变量" class="headerlink" title="2 编辑环境变量"></a>2 编辑环境变量</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/profile  #centos7 系统环境变量位置  在最后面加入如下内容 保存退出</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#set java environment  </span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.171-8.b10.el7_5.x86_64   #根据自己安装的jdk路径而定</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin  </span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </span><br><span class="line">export JAVA_HOME  CLASSPATH  PATH</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">source  /etc/profile  #生效环境配置</span><br></pre></td></tr></table></figure>

<h3 id="3-测试"><a href="#3-测试" class="headerlink" title="3 测试"></a>3 测试</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo $JAVA_HOME</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601010346863?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180601010438714?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/05/31/xsell如何将文件上传虚拟机/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/31/xsell如何将文件上传虚拟机/" itemprop="url">xsell如何将文件上传虚拟机</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-31T22:51:28+08:00">
                2018-05-31
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80531336" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80531336</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><p>1 、xsell工具</p>
<p>2 、 虚拟机（以centos7为例）</p>
<h2 id="二-关键步骤"><a href="#二-关键步骤" class="headerlink" title="二 关键步骤"></a>二 关键步骤</h2><p>1 安装 lrzsz工具</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install lrzsz -y</span><br></pre></td></tr></table></figure>

<p>备注：rz，sz是便是Linux/Unix同Windows进行ZModem文件传输的命令行工具。<br>运行命令rz，xshell就会弹出文件选择对话框，winodws–&gt;linux当前目录。<br>运行命令sz file linux–&gt;window目录。</p>
<p>2 使用rz命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /目标目录</span><br><span class="line">rz</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdn.net/20180531224840297?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180531224936192?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180531225008551?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/05/28/SpringBoot Maven环境下实现cache缓存/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/28/SpringBoot Maven环境下实现cache缓存/" itemprop="url">SpringBoot Maven环境下实现cache缓存</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-28T00:10:52+08:00">
                2018-05-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80466050" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80466050</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><h3 id="1-SpringBoot-maven"><a href="#1-SpringBoot-maven" class="headerlink" title="1.SpringBoot + maven"></a>1.SpringBoot + maven</h3><p>2.本文使用分布式缓存 即以redis作为缓存容器</p>
<h2 id="二-项目依赖"><a href="#二-项目依赖" class="headerlink" title="二 项目依赖"></a>二 项目依赖</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">		&lt;dependency&gt;</span><br><span class="line">			&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">			&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">			&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">		&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>备注：依次为redis支持，web支持，测试支持。</p>
<h2 id="三-项目目录结构"><a href="#三-项目目录结构" class="headerlink" title="三 项目目录结构"></a>三 项目目录结构</h2><p><img src="https://img-blog.csdn.net/20180526233146590?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="1-配置文件application"><a href="#1-配置文件application" class="headerlink" title="1 配置文件application"></a>1 配置文件application</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">#========== 服务器 配置信息===========#</span><br><span class="line">#服务器端口映射</span><br><span class="line">server.port=8099</span><br><span class="line">#服务项目名</span><br><span class="line">server.servlet.path=/SpringBoot-cache</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#==========cache 配置信息===========#</span><br><span class="line">#缓存保存时间 单位ms</span><br><span class="line">spring.cache.redis.time-to-live=10000</span><br><span class="line">#缓存类别 可以不设置系统自动识别</span><br><span class="line">spring.cache.type=redis</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#==========redis 配置信息===========#</span><br><span class="line"></span><br><span class="line">#（单机redis）数据库ip</span><br><span class="line">spring.redis.host=127.0.0.1</span><br><span class="line">#（单机redis）数据库端口</span><br><span class="line">spring.redis.port= 6379</span><br><span class="line">#数据库指定索引</span><br><span class="line">spring.redis.database= 1</span><br><span class="line">#数据库密码</span><br><span class="line">spring.redis.password=</span><br><span class="line">#超时时间</span><br><span class="line">spring.redis.timeout= 5000</span><br><span class="line">#连接池最大连接数，负值表示不限制</span><br><span class="line">spring.redis.jedis.pool.max-active= 1000</span><br><span class="line">#连接池中最大空闲连接</span><br><span class="line">spring.redis.jedis.pool.max-idle= 10</span><br><span class="line">#连接池中最小空闲连接</span><br><span class="line">spring.redis.jedis.pool.min-idle= 2</span><br><span class="line">#连接池最大阻塞等待时间，负值表示不限制</span><br><span class="line">spring.redis.jedis.pool.max-wait= -1</span><br></pre></td></tr></table></figure>

<p>备注：由于使用redis作为缓存容器，需要redis配置。spring-cache能自动识别缓存类别，redis采用缓存时效性管理缓存。</p>
<p>也可以自定义缓存策略进行缓存算法<a href="https://blog.csdn.net/caomiao2006/article/details/53313853" target="_blank" rel="noopener">缓存算法</a></p>
<h3 id="2-缓存配置-CacheConfig"><a href="#2-缓存配置-CacheConfig" class="headerlink" title="2 缓存配置 CacheConfig"></a>2 缓存配置 CacheConfig</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.cache;</span><br><span class="line"></span><br><span class="line">import org.springframework.cache.annotation.CachingConfigurerSupport;</span><br><span class="line">import org.springframework.cache.annotation.EnableCaching;</span><br><span class="line">import org.springframework.cache.interceptor.KeyGenerator;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">import java.lang.reflect.Method;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: 缓存配置文件</span><br><span class="line">*@Author: zyj 2018/5/26 18:04</span><br><span class="line">*/</span><br><span class="line">@Configuration</span><br><span class="line">@EnableCaching /**启用缓存**/</span><br><span class="line">public class CacheConfig extends CachingConfigurerSupport &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    *@Description: 重写主键生成策略</span><br><span class="line">    *@Author: zyj 2018/5/26 18:15</span><br><span class="line">    */</span><br><span class="line">    @Override</span><br><span class="line">    public KeyGenerator keyGenerator() &#123;</span><br><span class="line">        return new KeyGenerator() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public Object generate(Object o, Method method, Object... objects)&#123;</span><br><span class="line">                //TODO 结合object和method上面的注解信息 进行缓存注解设计</span><br><span class="line">                StringBuilder sb = new StringBuilder();</span><br><span class="line">                sb.append(&quot;KEY--&quot;);</span><br><span class="line">                sb.append(o.getClass().getName());</span><br><span class="line">                sb.append(method.getName());</span><br><span class="line">                for (Object obj : objects) &#123;</span><br><span class="line">                    sb.append(obj.toString());</span><br><span class="line">                &#125;</span><br><span class="line">                System.out.println(sb.toString());</span><br><span class="line">                return sb.toString();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：若不自定义缓存主键自定义，则不需要继承和重写方法，仅需要@EnableCache</p>
<h3 id="3-缓存使用-CacheTestService"><a href="#3-缓存使用-CacheTestService" class="headerlink" title="3.缓存使用 CacheTestService"></a>3.缓存使用 CacheTestService</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.service;</span><br><span class="line"></span><br><span class="line">import com.zyj.bean.CacheTestBean;</span><br><span class="line">import com.zyj.cache.CacheConfig;</span><br><span class="line">import io.netty.util.internal.StringUtil;</span><br><span class="line">import org.springframework.cache.annotation.CacheEvict;</span><br><span class="line">import org.springframework.cache.annotation.CachePut;</span><br><span class="line">import org.springframework.cache.annotation.Cacheable;</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.util.Date;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: 缓存测试服务</span><br><span class="line">*@Author: zyj 2018/5/26 18:32</span><br><span class="line">*/</span><br><span class="line">@Service</span><br><span class="line">public class CacheTestService &#123;</span><br><span class="line">    /**模拟数据库进行存储**/</span><br><span class="line">    public  Map&lt;String,CacheTestBean&gt; list = new HashMap&lt;String,CacheTestBean&gt;();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    *@Description: 添加到map</span><br><span class="line">    *@Author: zyj 2018/5/26 18:43</span><br><span class="line">    */</span><br><span class="line">    @CachePut(value = &quot;cacheTestBean&quot;, key=&quot;#cacheTestBean.key&quot;,condition = &quot;#cacheTestBean.name != null &quot;)</span><br><span class="line">    public CacheTestBean add(CacheTestBean cacheTestBean)&#123;</span><br><span class="line">        if(null!=cacheTestBean</span><br><span class="line">                &amp;&amp;!StringUtil.isNullOrEmpty(cacheTestBean.getKey())</span><br><span class="line">                &amp;&amp;!list.containsKey(cacheTestBean.getKey()))&#123;</span><br><span class="line">            /**设置创建时间**/</span><br><span class="line">            cacheTestBean.setCreatTime(new Date());</span><br><span class="line">            System.out.println(&quot;添加到内存:&quot;+cacheTestBean);</span><br><span class="line">            return list.put(cacheTestBean.getKey(),cacheTestBean);</span><br><span class="line">        &#125;</span><br><span class="line">        return new CacheTestBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *@Description: 获取map</span><br><span class="line">     *@Author: zyj 2018/5/26 18:43</span><br><span class="line">     */</span><br><span class="line">    @Cacheable(value = &quot;cacheTestBean&quot;,key=&quot;#key&quot;, condition = &quot;#key != null &quot;)</span><br><span class="line">    public CacheTestBean get(String key)&#123;</span><br><span class="line">        if(!StringUtil.isNullOrEmpty(key)&amp;&amp;list.containsKey(key))&#123;</span><br><span class="line">            CacheTestBean current=list.get(key);</span><br><span class="line">            /**设置更新时间**/</span><br><span class="line">            current.setUpdateTime(new Date());</span><br><span class="line">            list.put(key,current);</span><br><span class="line">            System.out.println(&quot;读取内存:&quot;+current);</span><br><span class="line">            return current;</span><br><span class="line">        &#125;</span><br><span class="line">        return new CacheTestBean();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *@Description: 删除map</span><br><span class="line">     *@Author: zyj 2018/5/26 18:43</span><br><span class="line">     */</span><br><span class="line">    @CacheEvict(value = &quot;cacheTestBean&quot;,key=&quot;#key&quot;,condition = &quot;#key != null &quot;)</span><br><span class="line">    public CacheTestBean del(String key)&#123;</span><br><span class="line">        if(!StringUtil.isNullOrEmpty(key)&amp;&amp;list.containsKey(key))&#123;</span><br><span class="line">            System.out.println(&quot;删除内存:&quot;+key);</span><br><span class="line">            return list.remove(key);</span><br><span class="line">        &#125;</span><br><span class="line">        return new CacheTestBean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：使用map代替数据库查询，不影响缓存使用。</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>最常用的注解，会把被注解方法的返回值缓存。工作原理是：首先在缓存中查找，如果没有执行方法并缓存结果，然后返回数据。此注解的缓存名必须指定，和cacheManager中的caches中的某一个Cache的name值相对应。可以使用value或cacheNames指定。<br>如果没有指定key属性，spring会使用默认的主键生成器产生主键。也可以自定义主键，在key中可以使用SpEL表达式。<br>value (也可使用 cacheNames) : 可看做命名空间，表示存到哪个缓存里了。<br>key : 表示命名空间下缓存唯一key,使用Spring Expression Language(简称SpEL,详见参考文献[5])生成。<br>condition : 表示在哪种情况下才缓存结果(对应的还有unless,哪种情况不缓存),同样使用SpEL</p>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><p>该注解负责从缓存中显式移除数据，通常缓存数据都有有效期，当过期时数据也会被移除。<br>value (也可使用 cacheNames) : 同Cacheable注解，可看做命名空间。表示删除哪个命名空间中的缓存<br>allEntries: 标记是否删除命名空间下所有缓存，默认为false<br>condition : 表示在哪种情况下才缓存结果(对应的还有unless,哪种情况不缓存),同样使用SpEL<br>key: 同Cacheable注解，代表需要删除的命名空间下唯一的缓存key。<br>beforeInvocation：在方法调用前还是调用后完成移除操作。true/false  </p>
<h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><p>先执行方法，然后将返回值放回缓存。可以用作缓存的更新，可用于后台保存配置时及时刷新缓存。<br>value: 同上<br>key: 同上<br>condition(unless): 同上  </p>
<h3 id="4-缓存测试"><a href="#4-缓存测试" class="headerlink" title="4.缓存测试"></a>4.缓存测试</h3><p>CacheTestBean</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.bean;</span><br><span class="line"></span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Date;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: 缓存测试实体</span><br><span class="line">*@Author: zyj 2018/5/26 18:28</span><br><span class="line">*/</span><br><span class="line">public class CacheTestBean implements Serializable&#123;</span><br><span class="line"></span><br><span class="line">    /**键**/</span><br><span class="line">    String key;</span><br><span class="line">    /**值**/</span><br><span class="line">    String name;</span><br><span class="line">    /**创建时间**/</span><br><span class="line">    Date creatTime;</span><br><span class="line">    /**更新时间**/</span><br><span class="line">    Date updateTime;</span><br><span class="line"></span><br><span class="line">    public String getKey() &#123;</span><br><span class="line">        return key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setKey(String key) &#123;</span><br><span class="line">        this.key = key;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public String getName() &#123;</span><br><span class="line">        return name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setName(String name) &#123;</span><br><span class="line">        this.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getCreatTime() &#123;</span><br><span class="line">        return creatTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setCreatTime(Date creatTime) &#123;</span><br><span class="line">        this.creatTime = creatTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Date getUpdateTime() &#123;</span><br><span class="line">        return updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setUpdateTime(Date updateTime) &#123;</span><br><span class="line">        this.updateTime = updateTime;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String toString() &#123;</span><br><span class="line">        return &quot;CacheTestBean&#123;&quot; +</span><br><span class="line">                &quot;key=&apos;&quot; + key + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, name=&apos;&quot; + name + &apos;\&apos;&apos; +</span><br><span class="line">                &quot;, creatTime=&quot; + creatTime +</span><br><span class="line">                &quot;, updateTime=&quot; + updateTime +</span><br><span class="line">                &apos;&#125;&apos;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>CacheTestController</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.controller;</span><br><span class="line"></span><br><span class="line">import com.zyj.bean.CacheTestBean;</span><br><span class="line">import com.zyj.service.CacheTestService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import sun.misc.Cache;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: 缓存测试控制器</span><br><span class="line">*@Author: zyj 2018/5/26 18:51</span><br><span class="line">*/</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(&quot;/Cache&quot;)</span><br><span class="line">public class CacheTestController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    CacheTestService cacheTestService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    *@Description: 测试缓存</span><br><span class="line">    *@param cacheTestBean</span><br><span class="line">    *@return com.zyj.bean.CacheTestBean</span><br><span class="line">    *@Author: zyj 2018/5/26 22:47</span><br><span class="line">    */</span><br><span class="line">    @RequestMapping(&quot;/add&quot;)</span><br><span class="line">    public CacheTestBean testAdd(CacheTestBean cacheTestBean)&#123;</span><br><span class="line">        return cacheTestService.add(cacheTestBean);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *@Description: 测试获取缓存</span><br><span class="line">     *@param key</span><br><span class="line">     *@return com.zyj.bean.CacheTestBean</span><br><span class="line">     *@Author: zyj 2018/5/26 22:47</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(&quot;/get&quot;)</span><br><span class="line">    public CacheTestBean testGet(String key)&#123;</span><br><span class="line">        CacheTestBean current=cacheTestService.get(key);</span><br><span class="line">        System.out.println(&quot;获得数据&quot;+current);</span><br><span class="line">        return current;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     *@Description: 测试删除缓存</span><br><span class="line">     *@param key</span><br><span class="line">     *@return com.zyj.bean.CacheTestBean</span><br><span class="line">     *@Author: zyj 2018/5/26 22:47</span><br><span class="line">     */</span><br><span class="line">    @RequestMapping(&quot;/del&quot;)</span><br><span class="line">    public CacheTestBean testDel(String key)&#123;</span><br><span class="line">        return cacheTestService.del(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="5-测试结果"><a href="#5-测试结果" class="headerlink" title="5.测试结果"></a>5.测试结果</h4><p>存取数据，将进入数据已经缓存当中 命名格式以 缓存服务注释一致</p>
<p><img src="https://img-blog.csdn.net/20180527235800643?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180527235832586?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>读取数据 缓存已有则读取缓存数据 缓存失效后读取内存数据并再次缓存</p>
<p><img src="https://img-blog.csdn.net/20180528000204156?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p><img src="https://img-blog.csdn.net/20180528000306702?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p>备注：若不定义缓存key的规则，则使用CacheConfig中主键生成规则，亲测有效</p>
<p>祝你成功！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/05/27/centos7 虚拟机如何固定ip连接主机网络/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/27/centos7 虚拟机如何固定ip连接主机网络/" itemprop="url">centos7 虚拟机如何固定ip连接主机网络</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-27T17:11:07+08:00">
                2018-05-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80470272" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80470272</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><h3 id="1、vmware虚拟机"><a href="#1、vmware虚拟机" class="headerlink" title="1、vmware虚拟机"></a>1、vmware虚拟机</h3><h3 id="2、centos7系统"><a href="#2、centos7系统" class="headerlink" title="2、centos7系统"></a>2、centos7系统</h3><h2 id="二-配置虚拟机网络"><a href="#二-配置虚拟机网络" class="headerlink" title="二 配置虚拟机网络"></a>二 配置虚拟机网络</h2><h3 id="1、设置虚拟机网卡配置"><a href="#1、设置虚拟机网卡配置" class="headerlink" title="1、设置虚拟机网卡配置"></a>1、设置虚拟机网卡配置</h3><p>双击网络适配器修改网络为NAT 模式</p>
<p><img src="https://img-blog.csdn.net/20180527163407684?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="2、设置虚拟机网络配置"><a href="#2、设置虚拟机网络配置" class="headerlink" title="2、设置虚拟机网络配置"></a>2、设置虚拟机网络配置</h3><h4 id="（1）编辑–》虚拟网络编辑器–》更改设置（管理员权限）"><a href="#（1）编辑–》虚拟网络编辑器–》更改设置（管理员权限）" class="headerlink" title="（1）编辑–》虚拟网络编辑器–》更改设置（管理员权限）"></a>（1）编辑–》虚拟网络编辑器–》更改设置（管理员权限）</h4><h4 id="（2）选择vmnet8-nat模式网卡配置"><a href="#（2）选择vmnet8-nat模式网卡配置" class="headerlink" title="（2）选择vmnet8 nat模式网卡配置"></a>（2）选择vmnet8 nat模式网卡配置</h4><p> 勾选nat模式 并保持下面两个打勾</p>
<p><img src="https://img-blog.csdn.net/20180527163849611?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h4 id="（3）NAT设置-设置定网关ip-（默认就好）"><a href="#（3）NAT设置-设置定网关ip-（默认就好）" class="headerlink" title="（3）NAT设置 设置定网关ip （默认就好）"></a>（3）NAT设置 设置定网关ip （默认就好）</h4><p><img src="https://img-blog.csdn.net/2018052716421414?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h4 id="（4）设置子网ip-与nat子网ip相同-默认就好"><a href="#（4）设置子网ip-与nat子网ip相同-默认就好" class="headerlink" title="（4）设置子网ip 与nat子网ip相同 默认就好"></a>（4）设置子网ip 与nat子网ip相同 默认就好</h4><p><img src="https://img-blog.csdn.net/20180527164355615?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="3、设置centos7系统的ip"><a href="#3、设置centos7系统的ip" class="headerlink" title="3、设置centos7系统的ip"></a>3、设置centos7系统的ip</h3><h4 id="（1）寻找默认网卡配置文件"><a href="#（1）寻找默认网卡配置文件" class="headerlink" title="（1）寻找默认网卡配置文件"></a>（1）寻找默认网卡配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls /etc/sysconfig/network-scripts/</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/2018052716492322?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h4 id="（2）编辑网卡配置文件"><a href="#（2）编辑网卡配置文件" class="headerlink" title="（2）编辑网卡配置文件"></a>（2）编辑网卡配置文件</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/sysconfig/network-scripts/ifcfg-ens33</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">#BOOTPROTO=dhcp  设置为静态ip</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=94d1a582-77c5-4fb8-8498-7873faf89eef</span><br><span class="line">DEVICE=ens33</span><br><span class="line">#ONBOOT=no  设置与启动生效</span><br><span class="line">NOBOOT=yes</span><br><span class="line"></span><br><span class="line">#new</span><br><span class="line">IPADDR=192.168.253.3</span><br><span class="line">GATEWAY=192.168.253.2</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">DNS1=192.168.253.2</span><br></pre></td></tr></table></figure>

<p>备注：新增#new 编辑后esc+：wq保存退出</p>
<p>IPADDR=自定义ip（不和网关ip重复 且同网段）</p>
<p>GATEWAY=网关ip</p>
<p>NETMASK=子网掩码</p>
<p>DNS1=网关ip（必须指定dns1 否则无法上网）</p>
<h4 id="（3）重启网络服务"><a href="#（3）重启网络服务" class="headerlink" title="（3）重启网络服务"></a>（3）重启网络服务</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service network restart</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180527170457375?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="（4）查看ip"><a href="#（4）查看ip" class="headerlink" title="（4）查看ip"></a>（4）查看ip</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip addr</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180527170554839?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="（5）测试联网"><a href="#（5）测试联网" class="headerlink" title="（5）测试联网"></a>（5）测试联网</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180527170706312?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>祝你成功！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/05/26/SpringBoot maven环境下整合redis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/26/SpringBoot maven环境下整合redis/" itemprop="url">SpringBoot maven环境下整合redis</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-26T17:22:48+08:00">
                2018-05-26
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80463053" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80463053</a>   </p>
<h3 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h3><h3 id="1-SpringBoot项目-maven环境"><a href="#1-SpringBoot项目-maven环境" class="headerlink" title="1.SpringBoot项目+maven环境"></a>1.SpringBoot项目+maven环境</h3><p>2.安装好redis服务，并启动(本教程适合 单机，集群，哨兵模式的redis服务)</p>
<h3 id="二-配置依赖"><a href="#二-配置依赖" class="headerlink" title="二 配置依赖"></a>二 配置依赖</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">              &lt;!--redis依赖--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-data-redis&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">&lt;!--web开发支持--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line">              &lt;!--测试支持--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt;</span><br><span class="line">	&lt;scope&gt;test&lt;/scope&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>备注：eclipse通过sts SpringBoot 构建工具添加 web 与 nosql-redis 此依赖可以自动生成</p>
<p>idea 通过 Spring Initializr 也可以选定 web 与 nosql-redis 此依赖可以自动生成</p>
<p><img src="https://img-blog.csdn.net/20180526164907679?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="三-redis配置"><a href="#三-redis配置" class="headerlink" title="三 redis配置"></a>三 redis配置</h3><h3 id="1-项目目录结构"><a href="#1-项目目录结构" class="headerlink" title="1.项目目录结构"></a>1.项目目录结构</h3><p><img src="https://img-blog.csdn.net/20180526165510474?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="2-SpringBoot-配置文件-配置redis-信息"><a href="#2-SpringBoot-配置文件-配置redis-信息" class="headerlink" title="2.SpringBoot 配置文件 配置redis 信息"></a>2.SpringBoot 配置文件 配置redis 信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">#========== 服务器 配置信息===========#</span><br><span class="line">#服务器端口映射</span><br><span class="line">server.port=8099</span><br><span class="line">#服务项目名</span><br><span class="line">server.servlet.path=/SpringBoot-redis</span><br><span class="line"></span><br><span class="line">#==========redis 配置信息===========#</span><br><span class="line"></span><br><span class="line">#（单机redis）数据库ip</span><br><span class="line">#spring.redis.host=127.0.0.1</span><br><span class="line">#（单机redis）数据库端口</span><br><span class="line">#spring.redis.port= 6379</span><br><span class="line"></span><br><span class="line">#（cluster集群，不使用则不用开启）在群集中执行命令时要遵循的最大重定向数目。</span><br><span class="line">spring.redis.cluster.max-redirects=3</span><br><span class="line">#（cluster集群，不使用则不用开启）以逗号分隔的“主机：端口”对列表进行引导。</span><br><span class="line">spring.redis.cluster.nodes=127.0.0.1:7000,127.0.0.1:7001,127.0.0.1:7002,127.0.0.1:7003,127.0.0.1:7004,127.0.0.1:7005</span><br><span class="line"></span><br><span class="line">#（哨兵模式，不使用则不用开启）Redis服务器的名称。</span><br><span class="line"># spring.redis.sentinel.master=</span><br><span class="line">#（哨兵模式，不使用则不用开启）主机：端口对的逗号分隔列表。</span><br><span class="line"># spring.redis.sentinel.nodes=</span><br><span class="line"></span><br><span class="line">#数据库指定索引</span><br><span class="line">spring.redis.database= 1</span><br><span class="line">#数据库密码</span><br><span class="line">spring.redis.password=</span><br><span class="line">#超时时间</span><br><span class="line">spring.redis.timeout= 5000</span><br><span class="line">#连接池最大连接数，负值表示不限制</span><br><span class="line">spring.redis.jedis.pool.max-active= 1000</span><br><span class="line">#连接池中最大空闲连接</span><br><span class="line">spring.redis.jedis.pool.max-idle= 10</span><br><span class="line">#连接池中最小空闲连接</span><br><span class="line">spring.redis.jedis.pool.min-idle= 2</span><br><span class="line">#连接池最大阻塞等待时间，负值表示不限制</span><br><span class="line">spring.redis.jedis.pool.max-wait= -1</span><br></pre></td></tr></table></figure>

<h3 id="3-redis配置集"><a href="#3-redis配置集" class="headerlink" title="3.redis配置集"></a>3.redis配置集</h3><p>RedisUtil.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.redis;</span><br><span class="line"></span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.util.CollectionUtils;</span><br><span class="line"></span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Set;</span><br><span class="line">import java.util.concurrent.TimeUnit;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: redis工具类</span><br><span class="line">*@Author: zyj 2018/5/26 8:02</span><br><span class="line">*/</span><br><span class="line">public class RedisUtil &#123;</span><br><span class="line"></span><br><span class="line">    private RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    public void setRedisTemplate(RedisTemplate&lt;String, Object&gt; redisTemplate) &#123;</span><br><span class="line">        this.redisTemplate = redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    //=============================common============================</span><br><span class="line">    /**</span><br><span class="line">     * 指定缓存失效时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean expire(String key,long time)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(time&gt;0)&#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据key 获取过期时间</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @return 时间(秒) 返回0代表为永久有效</span><br><span class="line">     */</span><br><span class="line">    public long getExpire(String key)&#123;</span><br><span class="line">        return redisTemplate.getExpire(key,TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断key是否存在</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean hasKey(String key)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.hasKey(key);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除缓存</span><br><span class="line">     * @param key 可以传一个值 或多个</span><br><span class="line">     */</span><br><span class="line">    @SuppressWarnings(&quot;unchecked&quot;)</span><br><span class="line">    public void del(String ... key)&#123;</span><br><span class="line">        if(key!=null&amp;&amp;key.length&gt;0)&#123;</span><br><span class="line">            if(key.length==1)&#123;</span><br><span class="line">                redisTemplate.delete(key[0]);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                redisTemplate.delete(CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //============================String=============================</span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存获取</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return 值</span><br><span class="line">     */</span><br><span class="line">    public Object get(String key)&#123;</span><br><span class="line">        return key==null?null:redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存放入</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key,Object value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 普通缓存放入并设置时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒) time要大于0 如果time小于等于0 将设置无限期</span><br><span class="line">     * @return true成功 false 失败</span><br><span class="line">     */</span><br><span class="line">    public boolean set(String key,Object value,long time)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            if(time&gt;0)&#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 递增</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param delta 要增加几(大于0)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long incr(String key, long delta)&#123;</span><br><span class="line">        if(delta&lt;0)&#123;</span><br><span class="line">            throw new RuntimeException(&quot;递增因子必须大于0&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 递减</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param delta 要减少几(小于0)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long decr(String key, long delta)&#123;</span><br><span class="line">        if(delta&lt;0)&#123;</span><br><span class="line">            throw new RuntimeException(&quot;递减因子必须大于0&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        return redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //================================Map=================================</span><br><span class="line">    /**</span><br><span class="line">     * HashGet</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 不能为null</span><br><span class="line">     * @return 值</span><br><span class="line">     */</span><br><span class="line">    public Object hget(String key,String item)&#123;</span><br><span class="line">        return redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取hashKey对应的所有键值</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return 对应的多个键值</span><br><span class="line">     */</span><br><span class="line">    public Map&lt;Object,Object&gt; hmget(String key)&#123;</span><br><span class="line">        return redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * HashSet</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param map 对应多个键值</span><br><span class="line">     * @return true 成功 false 失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hmset(String key, Map&lt;String,Object&gt; map)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * HashSet 并设置时间</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param map 对应多个键值</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @return true成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hmset(String key, Map&lt;String,Object&gt; map, long time)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            if(time&gt;0)&#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true 成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hset(String key,String item,Object value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 向一张hash表中放入数据,如果不存在将创建</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒)  注意:如果已存在的hash表有时间,这里将会替换原有的时间</span><br><span class="line">     * @return true 成功 false失败</span><br><span class="line">     */</span><br><span class="line">    public boolean hset(String key,String item,Object value,long time) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            if(time&gt;0)&#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除hash表中的值</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 可以使多个 不能为null</span><br><span class="line">     */</span><br><span class="line">    public void hdel(String key, Object... item)&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key,item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断hash表中是否有该项的值</span><br><span class="line">     * @param key 键 不能为null</span><br><span class="line">     * @param item 项 不能为null</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean hHasKey(String key, String item)&#123;</span><br><span class="line">        return redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param by 要增加几(大于0)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public double hincr(String key, String item,double by)&#123;</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * hash递减</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param item 项</span><br><span class="line">     * @param by 要减少记(小于0)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public double hdecr(String key, String item,double by)&#123;</span><br><span class="line">        return redisTemplate.opsForHash().increment(key, item,-by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //============================set=============================</span><br><span class="line">    /**</span><br><span class="line">     * 根据key获取Set中的所有值</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Set&lt;Object&gt; sGet(String key)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据value从一个set中查询,是否存在</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return true 存在 false不存在</span><br><span class="line">     */</span><br><span class="line">    public boolean sHasKey(String key,Object value)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将数据放入set缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     * @return 成功个数</span><br><span class="line">     */</span><br><span class="line">    public long sSet(String key, Object...values) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将set数据放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     * @return 成功个数</span><br><span class="line">     */</span><br><span class="line">    public long sSetAndTime(String key,long time,Object...values) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            if(time&gt;0)</span><br><span class="line">            &#123;expire(key, time);&#125;</span><br><span class="line">            return count;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取set缓存的长度</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long sGetSetSize(String key)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除值为value的</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param values 值 可以是多个</span><br><span class="line">     * @return 移除的个数</span><br><span class="line">     */</span><br><span class="line">    public long setRemove(String key, Object ...values) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            return count;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    //===============================list=================================</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取list缓存的内容</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param start 开始</span><br><span class="line">     * @param end 结束  0 到 -1代表所有值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public List&lt;Object&gt; lGet(String key, long start, long end)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取list缓存的长度</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public long lGetListSize(String key)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 通过索引 获取list中的值</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param index 索引  index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public Object lGetIndex(String key,long index)&#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            return redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, Object value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, Object value, long time) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            if (time &gt; 0)</span><br><span class="line">            &#123;expire(key, time);&#125;</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, List&lt;Object&gt; value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 将list放入缓存</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @param time 时间(秒)</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean lSet(String key, List&lt;Object&gt; value, long time) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            if (time &gt; 0) expire(key, time);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据索引修改list中的某条数据</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param index 索引</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public boolean lUpdateIndex(String key, long index,Object value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            return true;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 移除N个值为value</span><br><span class="line">     * @param key 键</span><br><span class="line">     * @param count 移除多少个</span><br><span class="line">     * @param value 值</span><br><span class="line">     * @return 移除的个数</span><br><span class="line">     */</span><br><span class="line">    public long lRemove(String key,long count,Object value) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            return remove;</span><br><span class="line">        &#125; catch (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            return 0;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：此工具类包含大部分操作。</p>
<p>RedisConfig.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.redis;</span><br><span class="line"></span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.data.redis.connection.RedisConnectionFactory;</span><br><span class="line">import org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line">import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;</span><br><span class="line">import org.springframework.data.redis.serializer.StringRedisSerializer;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: redis配置文件</span><br><span class="line">*@Author: zyj 2018/5/26 8:06</span><br><span class="line">*/</span><br><span class="line">@Configuration</span><br><span class="line">public class RedisConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 实例化 RedisTemplate 对象</span><br><span class="line">     * 提供给 RedisUtil 使用</span><br><span class="line">     * @param redisConnectionFactory springboot配置好的连接工厂</span><br><span class="line">     * @return RedisTemplate</span><br><span class="line">     * @autor zyj</span><br><span class="line">     * @date 2018年5月26日 08:47:27</span><br><span class="line">     */</span><br><span class="line">    @Bean</span><br><span class="line">    public RedisTemplate&lt;String, Object&gt; RedisTemplate(RedisConnectionFactory redisConnectionFactory) &#123;</span><br><span class="line">        RedisTemplate&lt;String, Object&gt; redisTemplate = new RedisTemplate&lt;&gt;();</span><br><span class="line">        initRedisTemplate(redisTemplate, redisConnectionFactory);</span><br><span class="line">        return redisTemplate;</span><br><span class="line">    &#125;</span><br><span class="line">    /**</span><br><span class="line">     * 设置数据存入 redis 的序列化方式,并开启事务</span><br><span class="line">     *</span><br><span class="line">     * @param redisTemplate</span><br><span class="line">     * @param factory</span><br><span class="line">     * @autor zyj</span><br><span class="line">     * @date 2018年5月26日 08:47:27</span><br><span class="line">     */</span><br><span class="line">    private void initRedisTemplate(RedisTemplate&lt;String, Object&gt; redisTemplate, RedisConnectionFactory factory) &#123;</span><br><span class="line">        //如果不配置Serializer，那么存储的时候缺省使用String，如果用User类型存储，那么会提示错误User can&apos;t cast to String！</span><br><span class="line">        redisTemplate.setKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashKeySerializer(new StringRedisSerializer());</span><br><span class="line">        redisTemplate.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());</span><br><span class="line">        redisTemplate.setValueSerializer(new GenericJackson2JsonRedisSerializer());</span><br><span class="line">        // 开启事务</span><br><span class="line">        redisTemplate.setEnableTransactionSupport(true);</span><br><span class="line">        redisTemplate.setConnectionFactory(factory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 注入封装RedisTemplate 给RedisUtil提供操作类</span><br><span class="line">     * @param redisTemplate</span><br><span class="line">     * @return RedisUtil</span><br><span class="line">     * @autor zyj</span><br><span class="line">     * @date 2018年5月26日 08:47:27</span><br><span class="line">     */</span><br><span class="line">    @Bean(name = &quot;redisUtil&quot;)</span><br><span class="line">    public RedisUtil redisUtil(RedisTemplate&lt;String, Object&gt; redisTemplate) &#123;</span><br><span class="line">        RedisUtil redisUtil = new RedisUtil();</span><br><span class="line">        redisUtil.setRedisTemplate(redisTemplate);</span><br><span class="line">        return redisUtil;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>备注：此类配置了redis的操作对象 RedisTemplate并将RedisUtil实例化到容器中</p>
<h3 id="四-redis测试"><a href="#四-redis测试" class="headerlink" title="四 redis测试"></a>四 redis测试</h3><h3 id="1-建立测试类"><a href="#1-建立测试类" class="headerlink" title="1.建立测试类"></a>1.建立测试类</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">package com.zyj.redis;</span><br><span class="line"></span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">*@Description: redis 测试</span><br><span class="line">*@Author: zyj 2018/5/26 8:12</span><br><span class="line">*/</span><br><span class="line">@Controller</span><br><span class="line">@RequestMapping(&quot;/redisTest&quot;)</span><br><span class="line">public class RedisTestController &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    RedisUtil redisUtil;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    *@Description: 测试redis</span><br><span class="line">    *@param key, value</span><br><span class="line">    *@return Object</span><br><span class="line">    *@Author: zyj 2018/5/26 8:46</span><br><span class="line">    */</span><br><span class="line">    @RequestMapping(&quot;/testRedisAdd&quot;)</span><br><span class="line">    @ResponseBody</span><br><span class="line">    Object testRedisAdd(String key,String value)&#123;</span><br><span class="line">        redisUtil.set(key,value);</span><br><span class="line">        return redisUtil.get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="2-测试"><a href="#2-测试" class="headerlink" title="2.测试"></a>2.测试</h3><p>启动springBoot项目SpringbootRedisApplication，网址中输入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost:8099/SpringBoot-redis/redisTest/testRedisAdd?key=1&amp;value=244</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180526171432988?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>备注：http：//服务器ip：端口/服务器跟路径/测试类控制器/测试方法？参数1= &amp;参数2= </p>
<h3 id="3-验证"><a href="#3-验证" class="headerlink" title="3.验证"></a>3.验证</h3><p>使用redis客户端连接redis服务</p>
<p><img src="https://img-blog.csdn.net/20180526171726910?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>依次验证数据</p>
<p><img src="https://img-blog.csdn.net/20180526171822208?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/20180526171841315?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/2018052617185480?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<p><img src="https://img-blog.csdn.net/20180526171905760?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/20180526171917367?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/20180526171927359?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>祝你成功！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://HandsomeMars.github.io/2018/05/24/docker 部署 redis-cluster集群/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="yujiang zheng">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="yujiang-zheng's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/05/24/docker 部署 redis-cluster集群/" itemprop="url">docker 部署 redis-cluster集群</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-05-24T19:21:11+08:00">
                2018-05-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p> <a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> </a> 版权声明：本文为博主原创文章，遵循<a href="http://creativecommons.org/licenses/by-sa/4.0/" target="_blank" rel="noopener"> CC 4.0 by-sa </a>版权协议，转载请附上原文出处链接和本声明。  本文链接：<a href="https://blog.csdn.net/qq_22211217/article/details/80436996" target="_blank" rel="noopener">https://blog.csdn.net/qq_22211217/article/details/80436996</a>   </p>
<h2 id="一-前期准备"><a href="#一-前期准备" class="headerlink" title="一 前期准备"></a>一 前期准备</h2><h3 id="1、centos-7-系统（网络桥接）-docker环境"><a href="#1、centos-7-系统（网络桥接）-docker环境" class="headerlink" title="1、centos 7 系统（网络桥接）+docker环境"></a>1、centos 7 系统（网络桥接）+docker环境</h3><p>2、centos 7 基本命令支持 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install wegt  ##安装下载工具</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install net-tools  ##安装网络工具</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install tree  ##安装tree命令（方便查看集群配置文件结构）</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y update ##跟新系统</span><br></pre></td></tr></table></figure>



<h2 id="二-安装集群环境"><a href="#二-安装集群环境" class="headerlink" title="二 安装集群环境"></a>二 安装集群环境</h2><h3 id="1-安装ruby镜像-tag省略默认下载lasted"><a href="#1-安装ruby镜像-tag省略默认下载lasted" class="headerlink" title="1 安装ruby镜像 tag省略默认下载lasted"></a>1 安装ruby镜像 tag省略默认下载lasted</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull ruby</span><br></pre></td></tr></table></figure>

<h3 id="2-安装redis镜像"><a href="#2-安装redis镜像" class="headerlink" title="2 安装redis镜像"></a>2 安装redis镜像</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker pull redis:4.0</span><br></pre></td></tr></table></figure>

<h4 id="备注：redis官方集群方案-为4-0版本自带"><a href="#备注：redis官方集群方案-为4-0版本自带" class="headerlink" title="备注：redis官方集群方案 为4.0版本自带"></a>备注：redis官方集群方案 为4.0版本自带</h4><h3 id="3-安装结果如下"><a href="#3-安装结果如下" class="headerlink" title="3 安装结果如下"></a>3 安装结果如下</h3><p><img src="https://img-blog.csdn.net/20180524171406248?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h2 id="备注：mysql镜像与本教程无关，redis两个版本其实为相同镜像，不影响使用"><a href="#备注：mysql镜像与本教程无关，redis两个版本其实为相同镜像，不影响使用" class="headerlink" title="备注：mysql镜像与本教程无关，redis两个版本其实为相同镜像，不影响使用"></a>备注：mysql镜像与本教程无关，redis两个版本其实为相同镜像，不影响使用</h2><h2 id="三、集群配置"><a href="#三、集群配置" class="headerlink" title="三、集群配置"></a>三、集群配置</h2><h3 id="1-创建虚拟网卡"><a href="#1-创建虚拟网卡" class="headerlink" title="1 创建虚拟网卡"></a>1 创建虚拟网卡</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker create network redis-net</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network ls ##查看网卡信息</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180524173107122?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="备注：创建redis-net虚拟网卡-目的是让docker容器能与宿主（centos7）桥接网络-并间接与外界连接"><a href="#备注：创建redis-net虚拟网卡-目的是让docker容器能与宿主（centos7）桥接网络-并间接与外界连接" class="headerlink" title="备注：创建redis-net虚拟网卡 目的是让docker容器能与宿主（centos7）桥接网络 并间接与外界连接"></a>备注：创建redis-net虚拟网卡 目的是让docker容器能与宿主（centos7）桥接网络 并间接与外界连接</h4><h3 id="2-查看redis-net虚拟网卡网关ip"><a href="#2-查看redis-net虚拟网卡网关ip" class="headerlink" title="2 查看redis-net虚拟网卡网关ip"></a>2 查看redis-net虚拟网卡网关ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect  redis-net  | grep &quot;Gateway&quot; |  grep --color=auto -P &apos;(\d&#123;1,3&#125;.)&#123;3&#125;\d&#123;1,3&#125;&apos; -o</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180524172130228?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="备注：docker-network-inspect-network-name-显示-network-name对应配置信息-（gerp-过滤网关配置行-并筛选ip-）-可人工"><a href="#备注：docker-network-inspect-network-name-显示-network-name对应配置信息-（gerp-过滤网关配置行-并筛选ip-）-可人工" class="headerlink" title="备注：docker network inspect network-name 显示 network-name对应配置信息 （gerp 过滤网关配置行 并筛选ip ） 可人工"></a>备注：docker network inspect network-name 显示 network-name对应配置信息 （gerp 过滤网关配置行 并筛选ip ） 可人工</h4><h3 id="3-创建配置文件模版"><a href="#3-创建配置文件模版" class="headerlink" title="3 创建配置文件模版"></a>3 创建配置文件模版</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir /home/redis-cluster ##在home 目录下创建 集群配置文件加</span><br><span class="line">cd /home/redis-cluster    ##在创建目录中</span><br><span class="line">touch redis-cluster.tmpl  ##创建模版件</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi redis-cluster.tmpl ##编辑模版文件</span><br></pre></td></tr></table></figure>

<h4 id="备注：编辑如下-esc-：wq退出"><a href="#备注：编辑如下-esc-：wq退出" class="headerlink" title="备注：编辑如下 esc+：wq退出"></a>备注：编辑如下 esc+：wq退出</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">port $&#123;PORT&#125;                        ##节点端口</span><br><span class="line">cluster-enabled yes                 ##cluster集群模式</span><br><span class="line">cluster-config-file nodes.conf      ##集群配置名</span><br><span class="line">cluster-node-timeout 5000           ##超时时间  </span><br><span class="line">cluster-announce-ip 172.18.0.1      ##实际为各节点网卡分配ip  先用上网关ip代替</span><br><span class="line">cluster-announce-port $&#123;PORT&#125;       ##节点映射端口</span><br><span class="line">cluster-announce-bus-port 1$&#123;PORT&#125;  ##节点总线端</span><br><span class="line">appendonly yes                      ##持久化模式</span><br></pre></td></tr></table></figure>

<h4 id="备注：此模版文件为集群节点通用文件-其中-PORT-将读取命令行变量-ip则根据网卡分配ip进行替换-以保证节点配置文件除端口以及ip-全部一致。"><a href="#备注：此模版文件为集群节点通用文件-其中-PORT-将读取命令行变量-ip则根据网卡分配ip进行替换-以保证节点配置文件除端口以及ip-全部一致。" class="headerlink" title="备注：此模版文件为集群节点通用文件 其中${PORT} 将读取命令行变量 ip则根据网卡分配ip进行替换 以保证节点配置文件除端口以及ip 全部一致。"></a>备注：此模版文件为集群节点通用文件 其中${PORT} 将读取命令行变量 ip则根据网卡分配ip进行替换 以保证节点配置文件除端口以及ip 全部一致。</h4><h3 id="4-创建节点配置文件"><a href="#4-创建节点配置文件" class="headerlink" title="4 创建节点配置文件"></a>4 创建节点配置文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd /home/redis-cluster</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">for port in `seq 7010 7015`; do \</span><br><span class="line">  mkdir -p ./$&#123;port&#125;/conf \</span><br><span class="line">  &amp;&amp; PORT=$&#123;port&#125; envsubst &lt; ./redis-cluster.tmpl &gt; ./$&#123;port&#125;/conf/redis.conf \</span><br><span class="line">  &amp;&amp; mkdir -p ./$&#123;port&#125;/data; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="备注：命令译为-循环7010-7015-在当前目录下创建-701-conf-目录结构-（mkdir-p-递归创建目录）"><a href="#备注：命令译为-循环7010-7015-在当前目录下创建-701-conf-目录结构-（mkdir-p-递归创建目录）" class="headerlink" title="备注：命令译为 循环7010 - 7015 在当前目录下创建 701*/conf 目录结构 （mkdir -p 递归创建目录）"></a>备注：命令译为 循环7010 - 7015 在当前目录下创建 701*/conf 目录结构 （mkdir -p 递归创建目录）</h4><p> 设置701<em>为PORT变量 将当前目录下 模版文件 复制到 701</em>/conf/redis.conf 文件中<br> 在当前目录下创建 701*/data 目录结构 </p>
<h3 id="5-验证上步"><a href="#5-验证上步" class="headerlink" title="5 验证上步"></a>5 验证上步</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tree</span><br><span class="line">cat 701*/conf/redis.conf</span><br></pre></td></tr></table></figure>


<p><img src="https://img-blog.csdn.net/20180524175003925?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt><img src="https://img-blog.csdn.net/20180524175908519?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h4 id="备注-data目录本步骤为空-节点对应配置文件ip本步骤对应网管ip"><a href="#备注-data目录本步骤为空-节点对应配置文件ip本步骤对应网管ip" class="headerlink" title="备注:data目录本步骤为空 节点对应配置文件ip本步骤对应网管ip"></a>备注:data目录本步骤为空 节点对应配置文件ip本步骤对应网管ip</h4><h3 id="6-启动redis节点容器"><a href="#6-启动redis节点容器" class="headerlink" title="6 启动redis节点容器"></a>6 启动redis节点容器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">for port in `seq 7010 7015`; do \</span><br><span class="line">  docker run -d -ti -p $&#123;port&#125;:$&#123;port&#125; -p 1$&#123;port&#125;:1$&#123;port&#125; \</span><br><span class="line">  --privileged=true -v /home/redis-cluster/$&#123;port&#125;/conf/redis.conf:/usr/local/etc/redis/redis.conf \</span><br><span class="line">  --privileged=true -v /home/redis-cluster/$&#123;port&#125;/data:/data \</span><br><span class="line">  --restart always --name redis-$&#123;port&#125; --net redis-net \</span><br><span class="line">  --sysctl net.core.somaxconn=1024 redis redis-server /usr/local/etc/redis/redis.conf; \</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="备注：命令译为-循环7010-7015-运行redis-容器"><a href="#备注：命令译为-循环7010-7015-运行redis-容器" class="headerlink" title="备注：命令译为 循环7010 - 7015 运行redis 容器"></a>备注：命令译为 循环7010 - 7015 运行redis 容器</h4><h4 id="docker-run-运行"><a href="#docker-run-运行" class="headerlink" title="docker run 运行"></a>docker run 运行</h4><p>-d 守护进程模式<br>–restart always 保持容器启动<br>–name redis-710* 容器起名<br>–net redis-net 容器使用虚拟网卡<br>-p 指定宿主机器与容器端口映射 701<em>:701</em><br>-P 指定宿主机与容器redis总线端口映射 1701<em>:1701</em><br> –privileged=true -v /home/redis-cluster/701<em>/conf/redis.conf:/usr/local/etc/redis/redis.conf<br> 付权将宿主701*节点文件挂载到容器/usr/local/etc/redis/redis.conf 文件中<br>–privileged=true -v /home/redis-cluster/${port}/data:/data \<br> 付权将宿主701</em>/data目录挂载到容器/data目录中<br>–sysctl net.core.somaxconn=1024 redis redis-server /usr/local/etc/redis/redis.conf;<br> 容器根据挂载的配置文件启动 redis服务端</p>
<h3 id="7-验证容器启动"><a href="#7-验证容器启动" class="headerlink" title="7 验证容器启动"></a>7 验证容器启动</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker ps</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/2018052418145275?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h3 id="8-查看容器分配ip"><a href="#8-查看容器分配ip" class="headerlink" title="8 查看容器分配ip"></a>8 查看容器分配ip</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker network inspect redis-net</span><br></pre></td></tr></table></figure>

<p>结果</p>
<p><img src="https://img-blog.csdn.net/20180524182033808?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<h4 id="备注：每个容器对应分配了ip-需要修改节点配置文件redis-conf与其对应-并重启容器。"><a href="#备注：每个容器对应分配了ip-需要修改节点配置文件redis-conf与其对应-并重启容器。" class="headerlink" title="备注：每个容器对应分配了ip 需要修改节点配置文件redis.conf与其对应 并重启容器。"></a>备注：每个容器对应分配了ip 需要修改节点配置文件redis.conf与其对应 并重启容器。</h4><h3 id="9-修改节点-配置文件重启redis服务（容器中命令中度缺失不推荐）"><a href="#9-修改节点-配置文件重启redis服务（容器中命令中度缺失不推荐）" class="headerlink" title="9 修改节点 配置文件重启redis服务（容器中命令中度缺失不推荐）"></a>9 修改节点 配置文件重启redis服务（容器中命令中度缺失不推荐）</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker exec -it redis-701* /bin/bash   ##以命令行形式进入 redis-701*容器   </span><br><span class="line">vi /usr/local/etc/redis/redis.conf   ##编辑ip为上查询分配的ip 并esc+：wq退出</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180524182710542?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="备注：6个节点均要修改-并重新启动redis-service-根据修改的节点文件"><a href="#备注：6个节点均要修改-并重新启动redis-service-根据修改的节点文件" class="headerlink" title="备注：6个节点均要修改 并重新启动redis-service 根据修改的节点文件"></a>备注：6个节点均要修改 并重新启动redis-service 根据修改的节点文件</h4><h3 id="10-修改宿主挂载目录文件中文件-重复6、7-进行11"><a href="#10-修改宿主挂载目录文件中文件-重复6、7-进行11" class="headerlink" title="10 修改宿主挂载目录文件中文件 重复6、7 进行11"></a>10 修改宿主挂载目录文件中文件 重复6、7 进行11</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi  /home/redis-cluster/701*/conf/redis.conf  ##编辑ip为查询分配的ip 并esc+：wq退出</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdn.net/20180524185339462?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt></p>
<h4 id="暂停容器并删除容器-以便重复6步骤"><a href="#暂停容器并删除容器-以便重复6步骤" class="headerlink" title="暂停容器并删除容器 以便重复6步骤"></a>暂停容器并删除容器 以便重复6步骤</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">for port in `seq 7010 7015`; do \</span><br><span class="line">  docker stop redis-$&#123;port&#125;;</span><br><span class="line">  docker rm redis-$&#123;port&#125;;</span><br><span class="line">done</span><br></pre></td></tr></table></figure>

<h4 id="备注：6个都要修改redis-conf"><a href="#备注：6个都要修改redis-conf" class="headerlink" title="备注：6个都要修改redis.conf"></a>备注：6个都要修改redis.conf</h4><h3 id="11-启动redis-cluster集群"><a href="#11-启动redis-cluster集群" class="headerlink" title="11 启动redis-cluster集群"></a>11 启动redis-cluster集群</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">echo yes | docker run -i --rm --net redis-net ruby sh -c &apos;\</span><br><span class="line">  gem install redis \</span><br><span class="line">  &amp;&amp; wget http://download.redis.io/redis-stable/src/redis-trib.rb \</span><br><span class="line">  &amp;&amp; ruby redis-trib.rb create --replicas 1 \</span><br><span class="line">  &apos;&quot;$(for port in `seq 7010 7015`; do \</span><br><span class="line">    echo -n &quot;$(docker inspect --format &apos;&#123;&#123; (index .NetworkSettings.Networks &quot;redis-net&quot;).IPAddress &#125;&#125;&apos; &quot;redis-$&#123;port&#125;&quot;)&quot;:$&#123;port&#125; &apos; &apos; ; \</span><br><span class="line">  done)&quot;</span><br></pre></td></tr></table></figure>

<h4 id="备注：docker-run-i-交互模式启动-ruby-sh"><a href="#备注：docker-run-i-交互模式启动-ruby-sh" class="headerlink" title="备注：docker run -i 交互模式启动 ruby sh"></a>备注：docker run -i 交互模式启动 ruby sh</h4><p> gem intall redis 安装redis<br>–net redis-net 使用虚拟网卡桥接<br>wget 下载 redis集群启动 redis-trib.rb 包<br>ruby redis-trib create –replicas 1 17.18.0.x:701* …. ruby 运行集群包 添加redis节点6个 </p>
<p><img src="https://img-blog.csdn.net/20180524191222166?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzIyMjExMjE3/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt>  </p>
<p>祝你成功！</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">yujiang zheng</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">38</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yujiang zheng</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
